
//@ts-ignore
import TronWeb from "tronweb";
import fs from "fs";
import { ethers } from "hardhat";

const VERIFIERADDRESS = "TGoUX4Nuz5cwBnAEHf8ZTYEuph3vTfK9nH";
const DENOMINATION = ethers.utils.parseEther("100");
const FEEDIVIDER = 100;
const TOKENADDRESS = "TEfemFon6U3xS8twSVNqbhJxVVzZ7jwVs2" // USDT MOCK
const RELAYERADDRESS = "TWB3AJwL6Q1bRQBNipipvgf2gsDAgvgSBS" // For now the relayer is the owner!

async function main() {
  const tronWeb = new TronWeb({
    fullHost: process.env.SHASTA_TESTNET_API,
    headers: { "TRON-PRO-API-KEY": process.env.TRON_GRID_API_KEY },
    privateKey: process.env.PRIVATE_KEY_SHASTA
  });
  // I create a new tron web instance and deploy the contracts on shasta testnet!

  const erc20NoteJSONBUFF = fs.readFileSync("artifacts/contracts/ERC20Notes.sol/ERC20Notes.json");

  const erc20NoteArtifact = JSON.parse(erc20NoteJSONBUFF.toString());


  const parameters = [tronWeb.address.toHex(VERIFIERADDRESS), DENOMINATION, FEEDIVIDER, tronWeb.address.toHex(TOKENADDRESS), tronWeb.address.toHex(RELAYERADDRESS)]

  const options = {
    feeLimit: 1000000000,
    callValue: 0,
    tokenId: "",
    tokenValue: 0,
    userFeePercentage: 10,
    originEnergyLimit: 10,
    abi: JSON.stringify(erc20NoteArtifact.abi),
    bytecode: erc20NoteArtifact.bytecode,
    parameters: parameters,
    name: erc20NoteArtifact.contractName,
    permissionId: 0
  }

  const tx = await tronWeb.transactionBuilder.createSmartContract(options, process.env.ISSUER_ADDRESS).catch((err: any) => {
    console.log("Error Occured!")
    console.error(err);
  });

  const signedTx = await tronWeb.trx.sign(tx, process.env.PRIVATE_KEY_SHASTA);

  const receipt = await tronWeb.trx.sendRawTransaction(signedTx);

  console.log(receipt);

  // DEPLOYED CONTRACT ADDRESS: TWpr6tsT6zCBFKiq18CzKGmPzfSpP1ijyw
  // {
  // result: true,
  // txid: '192bd7f43eb1e9b9abddb5bcebf819e9947301403e4f7623713e380dce8276af',
  // transaction: {
  //   visible: false,
  //   txID: '192bd7f43eb1e9b9abddb5bcebf819e9947301403e4f7623713e380dce8276af',
  //   contract_address: '41e4c5de2afe6479202fd758dd2cbbdbffbfc1db09',
  //   raw_data: {
  //     contract: [Array],
  //     ref_block_bytes: '4a88',
  //     ref_block_hash: '6875548bbf08f0e2',
  //     expiration: 1666294932000,
  //     fee_limit: 1000000000,
  //     timestamp: 1666294872962
  //   },
  //   raw_data_hex: '0a024a8822086875548bbf08f0e240a0c4abb7bf305a936d081e128e6d0a30747970652e676f6f676c65617069732e636f6d2f70726f746f636f6c2e437265617465536d617274436f6e747261637412d96c0a1541dd9f4af3c838d2596da5c17841fa2df13637dfdc12bf6c0a1541dd9f4af3c838d2596da5c17841fa2df13637dfdc1adb090a72221412095f76657269666965721a07616464726573732218120d5f64656e6f6d696e6174696f6e1a0775696e743235362214120b5f666565446976696465721a0575696e7438221112065f746f6b656e1a0761646472657373221312085f72656c617965721a0761646472657373300140030a521a074465706f73697422170801120a636f6d6d69746d656e741a07627974657333322216120b6465706f736974656442791a07616464726573732214120974696d657374616d701a0775696e7432353630030a751a105769746864726177436173684e6f7465220f120466726f6d1a0761646472657373220d1202746f1a0761646472657373221a120f6e756c6c69666965724861736865731a07627974657333322210120570726963651a0775696e74323536221112066368616e67651a0775696e7432353630030a5e1a1057697468647261774769667443617264220f120466726f6d1a0761646472657373220d1202746f1a07616464726573732218120d6e756c6c6966696572486173681a0762797465733332220e12036665651a0775696e7432353630030a171a065f6f776e65722a091a0761646472657373300240020a94011a0b636f6d6d69746d656e747322091a07627974657333322a0c1204757365641a04626f6f6c2a12120763726561746f721a07616464726573732a141209726563657069656e741a07616464726573732a101208636173684e6f74651a04626f6f6c2a16120b63726561746564446174651a0775696e743235362a1412097370656e74446174651a0775696e74323536300240020a1d1a0c64656e6f6d696e6174696f6e2a091a0775696e74323536300240020a4e1a076465706f7369742216120b5f636f6d6d69746d656e741a076279746573333222101208636173684e6f74651a04626f6f6c2215120a6465706f736974466f721a0761646472657373300240040a141a036665652a091a0775696e74323536300240020a301a0769735370656e742219120e5f6e756c6c6966696572486173681a07627974657333322a061a04626f6f6c300240020a421a0c69735370656e744172726179221d12105f6e756c6c69666965724861736865731a09627974657333325b5d2a0f12057370656e741a06626f6f6c5b5d300240020a281a0f6e756c6c696669657248617368657322091a07627974657333322a061a04626f6f6c300240020a181a0772656c617965722a091a0761646472657373300240020a161a05746f6b656e2a091a0761646472657373300240020a191a0876657269666965722a091a0761646472657373300240020a8a011a107769746864726177436173684e6f7465221412065f70726f6f661a0a75696e743235365b385d2219120e5f6e756c6c6966696572486173681a07627974657333322216120b5f636f6d6d69746d656e741a07627974657333322215120a5f726563657069656e741a0761646472657373221212075f6368616e67651a0775696e74323536300240040a8a011a1077697468647261774769667443617264221412065f70726f6f661a0a75696e743235365b385d2219120e5f6e756c6c6966696572486173681a07627974657333322216120b5f636f6d6d69746d656e741a07627974657333322215120a5f726563657069656e741a0761646472657373221212075f6368616e67651a0775696e743235363002400322b76260a06040523480156200001157600080fd5b506040516200309738038062003097833981810160405281019062000037919062000223565b8484848360016000819055506000831162000089576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200008090620002cc565b60405180910390fd5b8373ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff1660601b81525050826001819055508160ff1683620000d89190620002ff565b60048190555033600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050505081600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050505050620004aa565b600081519050620001c18162000428565b92915050565b600081519050620001d88162000442565b92915050565b600081519050620001ef816200045c565b92915050565b600081519050620002068162000476565b92915050565b6000815190506200021d8162000490565b92915050565b600080600080600060a086880312156200023c57600080fd5b60006200024c88828901620001de565b95505060206200025f88828901620001f5565b945050604062000272888289016200020c565b93505060606200028588828901620001c7565b92505060806200029888828901620001b0565b9150509295509295909350565b6000620002b4602583620002ee565b9150620002c182620003d9565b604082019050919050565b60006020820190508181036000830152620002e781620002a5565b9050919050565b600082825260208201905092915050565b60006200030c8262000393565b9150620003198362000393565b9250826200032c576200032b620003aa565b5b828204905092915050565b6000620003448262000373565b9050919050565b6000620003588262000337565b9050919050565b60006200036c8262000337565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f44656e6f6d696e6174696f6e2073686f756c642062652067726561746572207460008201527f68616e2030000000000000000000000000000000000000000000000000000000602082015250565b620004338162000337565b81146200043f57600080fd5b50565b6200044d816200034b565b81146200045957600080fd5b50565b62000467816200035f565b81146200047357600080fd5b50565b620004818162000393565b81146200048d57600080fd5b50565b6200049b816200039d565b8114620004a757600080fd5b50565b60805160601c612bc0620004d760003960008181610513015281816107120152610deb0152612bc06000f3fe6080604052600436106100c15760003560e01c806393f40b6c1161007f578063b2bdfa7b11610059578063b2bdfa7b14610264578063ddca3f431461028f578063e5285dcc146102ba578063fc0c546a146102f7576100c1565b806393f40b6c146101e25780639fa12d0b1461020b578063af120ffa14610248576100c1565b8062f5f984146100c657806317cc915c146100e25780632b7ac3f31461011f578063839df9451461014a5780638406c0791461018c5780638bca6d16146101b7575b600080fd5b6100e060048036038101906100db9190611c09565b610322565b005b3480156100ee57600080fd5b5061010960048036038101906101049190611be0565b6104f1565b604051610116919061229e565b60405180910390f35b34801561012b57600080fd5b50610134610511565b6040516101419190612335565b60405180910390f35b34801561015657600080fd5b50610171600480360381019061016c9190611be0565b610535565b604051610183969594939291906122b9565b60405180910390f35b34801561019857600080fd5b506101a16105cb565b6040516101ae919061214c565b60405180910390f35b3480156101c357600080fd5b506101cc6105f1565b6040516101d99190612532565b60405180910390f35b3480156101ee57600080fd5b5061020960048036038101906102049190611b3b565b6105f7565b005b34801561021757600080fd5b50610232600480360381019061022d9190611af6565b610b44565b60405161023f9190612235565b60405180910390f35b610262600480360381019061025d9190611b3b565b610c7d565b005b34801561027057600080fd5b506102796112c4565b6040516102869190612167565b60405180910390f35b34801561029b57600080fd5b506102a46112ea565b6040516102b19190612532565b60405180910390f35b3480156102c657600080fd5b506102e160048036038101906102dc9190611be0565b6112f0565b6040516102ee919061229e565b60405180910390f35b34801561030357600080fd5b5061030c61131a565b604051610319919061231a565b60405180910390f35b60026000541415610368576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161035f906124f2565b60405180910390fd5b60026000819055506006600084815260200190815260200160002060000160009054906101000a900460ff16156103d4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103cb90612452565b60405180910390fd5b60016006600085815260200190815260200160002060000160006101000a81548160ff021916908315150217905550806006600085815260200190815260200160002060000160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550816006600085815260200190815260200160002060010160146101000a81548160ff0219169083151502179055504260066000858152602001908152602001600020600201819055506104aa81611340565b827f182fa52899142d44ff5c45a6354d3b3e868d5b07db6a65580b39bd321bdaf8ac82426040516104dc92919061220c565b60405180910390a26001600081905550505050565b60056020528060005260406000206000915054906101000a900460ff1681565b7f000000000000000000000000000000000000000000000000000000000000000081565b60066020528060005260406000206000915090508060000160009054906101000a900460ff16908060000160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010160149054906101000a900460ff16908060020154908060030154905086565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60015481565b6002600054141561063d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610634906124f2565b60405180910390fd5b60026000819055506005600085815260200190815260200160002060009054906101000a900460ff16156106a6576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161069d90612372565b60405180910390fd5b600015156006600085815260200190815260200160002060010160149054906101000a900460ff16151514610710576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610707906124d2565b60405180910390fd5b7f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16635fe8c13b604051806040016040528088600060088110610791577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60200201358152602001886001600881106107d5577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b6020020135815250604051806040016040528060405180604001604052808b60026008811061082d577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b602002013581526020018b600360088110610871577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b6020020135815250815260200160405180604001604052808b6004600881106108c3577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b602002013581526020018b600560088110610907577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b602002013581525081525060405180604001604052808a600660088110610957577f4e487b7100000000000000000000000000000000000000000000000000000000600052'... 18018 more characters,
  //   signature: [
  //     'dc88e0f3531b9295e82bba626b938f9e24e4abfa2add4ac624fad476e793372df74821d03d0b0ca462dbb1ccf390191b5682a4a1a490ebf0a7e1a94982059b0d01'
  //   ]
  // }
  //}

}



// main().catch((error) => {
//   console.error(error);
//   process.exitCode = 1;
// })

